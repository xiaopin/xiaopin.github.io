<html>
	<head>
		<title>地铁图</title>
		<meta charset="utf-8">
		<meta name="renderer" content="webkit">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=1.0, viewport-fit=cover">
		<meta name="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="format-detection" content="telephone=no">
		<meta name="format-detection" content="email=no">
		<style>
			.city-container {
				padding: 10px;
				background-color: rgba(0, 0, 0, 0.3);
				position: absolute;
				left: 0;
				top: 0;
				border-bottom-right-radius: 10px;
				z-index: 999;
			}
		</style>
	</head>
	<body>
		<div id="SubwayContainer"></div>
		<div class="city-container" style="display: none;">
			<select id="city-toggle" onchange="changedCity(this)"></select>
		</div>
	</body>
	<script type="text/javascript" src="https://webapi.amap.com/subway?v=1.0&key=98cb8314168440c4de1169ffac3a53e7&callback=subwayCityLoaded"></script>
	<script type="text/javascript">
	var mysubway = null;
	var cities = [];
	
	// 地铁加载完毕的回调
	window.subwayCityLoaded = function(){
		var defaultAdcode = '4403';
		mysubway = subway('SubwayContainer', {easy: 1, adcode: defaultAdcode});
		mysubway.getCityList(function(resp) {
			for (var adcode in resp) {
				var name = resp[adcode]['name'];
				var pinyin = resp[adcode]['city'];
				cities.push( {adcode: adcode, name: name, pinyin: pinyin} );
			}
			
			var selectTag = document.getElementById('city-toggle');
			cities.forEach(item => {
				var option = document.createElement('option');
				option.setAttribute('value', item.adcode);
				option.innerHTML = item.name;
				if (item.adcode == defaultAdcode) {
					option.selected = true;
				}
				selectTag.appendChild(option);
			});
			selectTag.parentNode.removeAttribute('style');
		});
	};

	// 切换城市
	function changedCity(tag) {
		var index = tag.selectedIndex;
		var adcode = cities[index].adcode;
		mysubway.setAdcode(adcode);
	}

	// if (window.addEventListener) {
	//     window.addEventListener('DOMContentLoaded', function() {
	//         if(/iPhone/ig.test(window.navigator.userAgent) && window.devicePixelRatio) {
	//             var iPhoneX = window.devicePixelRatio === 3 && window.screen.width === 375 && window.screen.height === 812;
	//             var iPhoneXSMax = window.devicePixelRatio === 3 && window.screen.width === 414 && window.screen.height === 896;
	//             var iPhoneXR = window.devicePixelRatio === 2 && window.screen.width === 414 && window.screen.height === 896;
	//             if (iPhoneX || iPhoneXSMax || iPhoneXR) {
	//             	//
	//             }
	//         }
	//     });
	// }
	</script>
</html>